!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("safe-fetch"),require("z-shop-event-bus")):"function"==typeof define&&define.amd?define(["safe-fetch","z-shop-event-bus"],t):"object"==typeof exports?exports.trackingInit=t(require("safe-fetch"),require("z-shop-event-bus")):e.trackingInit=t(e["safe-fetch"],e["z-shop-event-bus"])}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t["default"]=function(e){var t=window.encodeURIComponent(e.getAttribute("data-flow-id")),n=e.getAttribute("lang"),r=d.TRACE_URL,o="true"===e.getAttribute("data-measurement"),c=["//www.googletagmanager.com/gtm.js?id=GTM-"+(0,d.getGtmjsId)("ga")];(0,d.getBunchboxId)(n)&&!(0,l.getQuery)("nlbb")&&c.push("//cdn.bunchbox.co/"+(0,d.getBunchboxId)(n)+".min.js"),(0,l.addElementToDocument)(c),window.dataLayer=window.dataLayer||[],window.zdataLayer&&"object"==a(window.zdataLayer)?(window.zdataLayer.queue=[],window.zdataLayer.qstarted=!1):window.zdataLayer={queue:[],raw:[],started:!1,qstarted:!1},window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.addEventListener("load",function(){(0,l.getQuery)("appName")||(0,l.addElementToDocument)("//www.googletagmanager.com/gtm.js?id=GTM-"+(0,d.getGtmjsId)("mk")+"&l=dataLayer"),!o||window.ga&&ga.create&&window.google_tag_manager||(0,l.createImgPixel)((0,l.getTraceUrl)(r,"block",t));var e=(0,l.deleteLS)(d.LS_KEY);e.forEach(function(e){(0,l.sendBeacon)(d.TEB_URL,e)})});var s=(0,u["default"])(t,n),f=new i["default"](e,s);f.spawn(t,!0,o)};var o=n(7),i=r(o),c=n(5),u=r(c),l=n(2),d=n(1)},function(e,t,n){"use strict";function r(e){return c[e]}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ga",t=window.location.host,n=["m.zalando","m-fr.zalando","release.zalando.net"],r="d",a=!0,o=!1,c=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;if(t.includes(d)){if("release.zalando.net"===d&&!t.includes("m-"))break;r="m";break}}}catch(s){o=!0,c=s}finally{try{!a&&l["return"]&&l["return"]()}finally{if(o)throw c}}return i.l[e][r]}function o(e){return u.some(function(t){return e.indexOf(t)>=0})}Object.defineProperty(t,"__esModule",{value:!0}),t.getBunchboxId=r,t.getGtmjsId=a,t.isAllowedChildRequestID=o;var i=(t.TEB_URL="/api/rr/e",t.TRACE_URL="/api/rr/t",t.LS_KEY="zlnd_t",t.CLEANUP_PIXEL_DELAY=6e4,t.MAX_PIXEL_AGE=3e5,t.WAIT_TIME_MULTIPLIER=1e3,t.MAX_WAIT_TIME=6e4,t.CONST_WAIT_TIME_INC=10,t.WAIT_TIME_INC=[0,.2,.7,2,5],{l:{mk:{d:"T3W9FX",m:"K6LHJJ"},ga:{d:"M6DK9B",m:"M6DK9B"}},r:{mk:{d:"MHPXMZ",m:"PKFGPP"},ga:{d:"P47KRV",m:"P47KRV"}}}),c={"de-DE":"5318632f4ed7edc458000005","nl-NL":"54b51389a5df9b7e67c8bcee","fr-FR":"54b5135ea5df9b7e67c8bcea","it-IT":"54b51339a5df9b7e67c8bce9","en-GB":"54b51368a5df9b7e67c8bceb","de-AT":"54b512ffa5df9b7e67c8bce4","de-CH":"54b512f3a5df9b7e67c8bce3","fr-CH":"54b512e3a5df9b7e67c8bce2","pl-PL":"54b51393a5df9b7e67c8bcef","nl-BE":"54b51380a5df9b7e67c8bced","fr-BE":"54c7c5bac78112cb54739235","se-SE":"54b51312a5df9b7e67c8bce6","fi-FI":"54b5131ca5df9b7e67c8bce7","da-DK":"54b51308a5df9b7e67c8bce5","es-ES":"548ff4c7470c79a50b878473","no-NO":"54b51325a5df9b7e67c8bce8"},u=["change-cart-item-quantity","api/catalog/articles"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){return"string"==typeof e||e instanceof String?e.charAt(0).toUpperCase()+e.slice(1):e}function o(e,t){return"string"==typeof e||e instanceof String?e.charAt(e.length-1)==t?e:e+t:e}function i(e,t,n,r,a){var o=window.location.host,i=window.location.pathname;if(!o||!i){var c=document.createElement("a");c.href=document.URL,o=c.host||o,i=c.pathname||i}var u=a||window.encodeURIComponent(o+i);return e+"?step="+t+"&flowId="+n+"&url="+u+"&timestamp="+Date.now()+(r?"&try="+r:"")+"&image"}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.substr(n,t.length)===t}function u(e){if(null===e||"object"!==("undefined"==typeof e?"undefined":h(e)))return e;var t=e.constructor();for(var n in e)t[n]=u(e[n]);return t}function l(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.search,n="?"===t.charAt(0)?t.substring(1):"",r={},a=n.split("&"),o=0;o<a.length;o++){var i=a[o].split("=");r[i[0]]=i[1]}return!!e&&r[e]}function d(e,t){var n={};return e&&t&&Object.keys(e).forEach(function(r){n[t+a(r)]=e[r]}),n}function s(e,t,n){return!!e.hasOwnProperty(t)&&(e[n]=e[t],delete e[t],!0)}function f(e){var t=new Image(1,1);return t.src=e,t}function p(e,t){var n=JSON.parse(window.localStorage.getItem(e));n&&n.constructor==Array||(n=[]),n.push(t),window.localStorage.setItem(e,JSON.stringify(n))}function m(e){try{var t=JSON.parse(localStorage.getItem(e))}catch(n){}return t&&t instanceof Array&&t.length>0?(localStorage.setItem(e,"[]"),t):[]}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b["default"];return navigator.sendBeacon?navigator.sendBeacon(e,JSON.stringify(t)):(n(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})["catch"](function(e){return e}),!0)}function g(e){var t=["script","img"];"string"==typeof e&&(e=[e]),e.forEach(function(e){"string"==typeof e&&(e=[e,0]);var n=e[0],r=t[e[1]||0],a=document.createElement(r);switch(a.src=n,r){case"script":a.async=!0;break;case"img":a.width=1,a.height=1,a.style.position="absolute"}document.body.insertBefore(a,document.body.firstChild)})}Object.defineProperty(t,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.capitalize=a,t.setLastCharacter=o,t.getTraceUrl=i,t.startsWith=c,t.cloneObject=u,t.getQuery=l,t.prefixKeys=d,t.rename=s,t.createImgPixel=f,t.pushLS=p,t.deleteLS=m,t.sendBeacon=y,t.addElementToDocument=g;var v=n(3),b=r(v)},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t["default"]=function(e){function t(t){if(v){var n=(0,i.cloneObject)(t);if(n.flowId=window.decodeURIComponent(e),n.host=window.location.host,n.pathname=window.location.pathname,n.accept_language=h,!n.timestamp){var r=new Date;n.timestamp=r.toISOString()}t.eventAction!==f&&t.eventAction!==p||!window.localStorage||navigator.sendBeacon?(0,i.sendBeacon)(o.TEB_URL,n,b):(0,i.pushLS)(o.LS_KEY,n)}!window.zdataLayer||window.zdataLayer.qstarted?window.dataLayer.push(t):window.zdataLayer.queue.push(t)}function n(e,n,r,o){var c="object"==("undefined"==typeof o?"undefined":a(o))?(0,i.cloneObject)(o):{};c.event="event_tracking",c.eventCategory=e,c.eventAction=n,c.eventLabel=r,t(c)}function r(e){var n="object"==a(e.parameters)?(0,i.cloneObject)(e.parameters):{};n.event="event_tracking",n.eventAction=e.type,n.eventId=e.id,n.eventCategory=e.category,e.label&&(n.eventLabel=e.label),e.position&&(n.eventPosition=e.position),e.name&&(n.eventName=e.name),e.creative&&(n.eventCreative=e.creative),t(n)}function c(e){var n="object"==a(e.parameters)?(0,i.cloneObject)(e.parameters):{};n.event="event_tracking",n.eventAction=e.type,n.eventCategory=e.category,e.id&&e.list?(n.eventList=e.list,n.eventId=e.id):e.items&&(n.eventItems=e.items),e.label&&(n.eventLabel=e.label),e.position&&(n.eventPosition=e.position),t(n)}function l(e){(0,i.rename)(e,"type","event")&&t(e)}function m(e,t,r,a){return"string"==typeof e&&"string"==typeof t&&"string"==typeof r&&n(e,t,r,a),!1}function y(e){e&&e.type&&((0,i.startsWith)(e.type,"view")||(0,i.startsWith)(e.type,"click")||(0,i.startsWith)(e.type,"load")||(0,i.startsWith)(e.type,"swipe")||"remove from wishlist"==e.type?e.category&&e.label&&n(e.category,e.type,e.label,e.parameters):"product list view"==e.type||e.type==f?e.category&&(e.list&&e.id||e.items&&e.items[0]&&e.items[0].id&&e.items[0].list)&&c(e):"teaser view"==e.type||e.type==p?e.category&&e.id&&r(e):l(e))}function g(t){e=t}var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u["default"];return d["default"].on("tracking:click",function(e,t,n,r){m(e,t,n,r)}),d["default"].on("tracking:event",function(e){y(e)}),window.zdataLayer.started=!0,window.zdataLayer.raw.forEach(function(e){return d["default"].trigger("tracking:event",e)}),g};var o=n(1),i=n(2),c=n(3),u=r(c),l=n(4),d=r(l),s=!0,f="product list click",p="teaser click"},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){n(this,e),this.dp=new window.DOMParser}return r(e,[{key:"parseFromString",value:function(e,t){try{if((new DOMParser).parseFromString("",t))return this.dp.parseFromString.apply(this.dp,arguments)}catch(n){}if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var r=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?r.documentElement.innerHTML=e:r.body.innerHTML=e,r}return this.dp.parseFromString.apply(this.dp,arguments)}},{key:"html",value:function(e){return this.parseFromString("<html><head></head><body>"+e+"</body></html>","text/html")}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(6),u=r(c),l=n(3),d=r(l),s=n(4),f=r(s),p=n(2),m=n(1),y=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/api/rr/pr/",a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.TRACE_URL,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:d["default"];o(this,e),this.el=t,this.server=r,this.trace=i,this.fetch=c,this.updateFlowID=n,f["default"].on("tracking:child-request-id",function(e,t){(0,m.isAllowedChildRequestID)(t)&&(a.updateFlowID(e),a.spawn(window.encodeURIComponent(e),!1,!1))}),this.cleanUpTimeout=this.cleanUp()}return i(e,[{key:"addScriptsToElement",value:function(e){var t=this;if(!e)return!1;e=(new u["default"]).html(e);var n=[].slice.call(e.getElementsByTagName("script")),r=n.length;if(r>0){var a=Date.now();n.forEach(function(e){var n=document.createElement("script");n.setAttribute("data-track-timestamp",a),e.src?n.src=e.src:n.text=e.text,t.el.appendChild(n)})}return r}},{key:"removeOldChildrenFromElement",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),n=[].slice.call(this.el.children);return n.length>0&&n.forEach(function(n){var r=n.getAttribute("data-track-timestamp")-t;r>=m.MAX_PIXEL_AGE&&e.el.removeChild(n)}),!1}},{key:"spawn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Date.now(),c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=this.server+"sajax?flowId="+e+"&try="+r+(c?"&lastTry":"");this.fetch(u,{reportChildRequestId:!1}).then(function(a){if(200==a.status)return a.text();if((204==a.status||5==parseInt(a.status/100))&&r&&!c){Date.now()-i>=m.MAX_WAIT_TIME&&(c=!0);var u=m.WAIT_TIME_INC[r]?m.WAIT_TIME_INC[r]:m.CONST_WAIT_TIME_INC;return setTimeout(function(){return o.spawn(e,t,n,++r,i,c)},u*m.WAIT_TIME_MULTIPLIER),!1}return n&&(0,p.createImgPixel)((0,p.getTraceUrl)(o.trace,"ajax-fail-"+a.status,e,r)),!0}).then(function(i){if(i)try{var c=o.addScriptsToElement(i);n&&c>0&&(0,p.createImgPixel)((0,p.getTraceUrl)(o.trace,"pixels-merged",e,r))}catch(u){n&&(0,p.createImgPixel)((0,p.getTraceUrl)(o.trace,"ajax-mergefail",e,r))}finally{if(t){var l=window.dataLayer.some(function(e){return e["gtm.start"]});if(l||window.dataLayer.push({"gtm.start":Date.now(),event:"gtm.js",shopPageFlowId:e,shopPageType:"TRACKING_FALLBACK"}),!window.zdataLayer.qstarted){var d;window.zdataLayer.qstarted=!0,window.zdataLayer.queue.length&&(d=window.dataLayer).push.apply(d,a(window.zdataLayer.queue))}}}})}},{key:"cleanUp",value:function(){var e=this;return window.setTimeout(function(){e.removeOldChildrenFromElement(),e.cleanUpTimeout=e.cleanUp()},m.CLEANUP_PIXEL_DELAY)}}]),e}();t["default"]=y}])});